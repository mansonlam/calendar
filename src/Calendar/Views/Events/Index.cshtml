@using Microsoft.AspNetCore.Authorization;
@using System.Security.Claims;

@model IEnumerable<Calendar.Models.Event>

@inject Calendar.Controllers.AppSettingsController appsettings

@{
    ViewData["Title"] = "Event List";
}

<h2>@ViewData["Title"]</h2>

@if (@User.IsInRole("Admins"))
{
<p>
    <a asp-action="Create">Create New</a>
</p>
}

<!--<table class="table" style="table-layout:fixed">-->
<table class="table table-striped table-bordered table-hover">
    <thead class="thead-inverse" style="color:#eceeef;background-color:#373a3c">
        <tr>
            <th></th>
            <th width="15%">
                @Html.DisplayNameFor(model => model.StartDateTime)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Category)
            </th>
            <th width="30%">
                @Html.DisplayNameFor(model => model.Subject)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.AffectedHosts)
            </th>
            <th width="10%">
                @Html.DisplayNameFor(model => model.AffectedProjects)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.AffectedTeams)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Reference)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Result)
            </th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model)
{
        <tr>
            <td>
                @if (User.IsInRole("Admins")) {
                    <a class="btn btn-default btn-xs glyphicon glyphicon-trash" role="button" asp-action="Delete" asp-route-id="@item.ID"></a>
                }
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.StartDateTime)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Category)
            </td>
            <td>
                @if (User.IsInRole("Admins"))
                {
                    <a role="button" style="text-decoration:none;" asp-action="Edit" asp-route-id="@item.ID">@item.Subject</a>
                }
                else
                {
                    <a asp-action="Details" asp-route-id="@item.ID">@item.Subject</a>
                }
                @* @Html.DisplayFor(modelItem => item.Subject) *@
            </td>
            <td>
                @{
                    String affectedhosts = item.AffectedHosts.Replace(",", ", ");
                    @affectedhosts
                    <a target=_blank href="@appsettings.IA_Url?q=@item.AffectedHosts" class='glyphicon glyphicon-flash' style='color:red' title='Perform Impact Analysis'></a>
                }
            </td>
            <td>
                @{
                    String affectedprojects = item.AffectedProjects.Replace(",", ", ");
                    @affectedprojects
                    <a target=_blank href="@appsettings.IA_Url?system=@item.AffectedProjects" class='glyphicon glyphicon-flash' style='color:red' title='Perform Impact Analysis'></a>
                }
            </td>
            <td>
                @{
                    String affectedteams = item.AffectedTeams.Replace(",", ", ");
                    @affectedteams
                }
            </td>
            <td>                
                @if (!String.IsNullOrEmpty(item.Reference))
                {
                    <a href="@appsettings.CM_Url?i_CRN=@item.Reference">@item.Reference</a>
                }
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Result)                
            </td>
@*
            <td>
                <ul>
                    <li @(User.IsInRole("Admins")? "" : "hidden")><a asp-action="Delete" asp-route-id="@item.ID">Delete</a></li>
                    <li @(User.IsInRole("Admins")? "" : "hidden")><a asp-action="Edit" asp-route-id="@item.ID">Edit</a></li>
                    <li><a asp-action="Details" asp-route-id="@item.ID">Details</a></li>                    
                </ul>
            </td>
*@
        </tr>
}
    </tbody>
</table>
